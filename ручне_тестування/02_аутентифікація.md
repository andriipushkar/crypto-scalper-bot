# Тести аутентифікації та безпеки

## 1. JWT Аутентифікація

### TC-016: Вхід з валідними credentials
**Кроки:**
1. Відкрити дашборд
2. Якщо з'явилось вікно логіну, ввести:
   - Username: admin (або з .env)
   - Password: відповідний пароль
3. Натиснути "Login"

**Очікуваний результат:**
- [ ] Успішний вхід
- [ ] Перенаправлення на дашборд
- [ ] Access token збережено в localStorage
- [ ] Refresh token збережено

### TC-017: Вхід з невалідними credentials
**Кроки:**
1. Ввести неправильний логін/пароль
2. Натиснути "Login"

**Очікуваний результат:**
- [ ] Помилка "Invalid credentials" або аналогічна
- [ ] Немає перенаправлення
- [ ] Токен не збережено

### TC-018: Автоматичне оновлення токена
**Кроки:**
1. Залогінитись
2. Почекати до закінчення терміну дії access token (або встановити короткий час)
3. Виконати будь-яку дію

**Очікуваний результат:**
- [ ] Токен автоматично оновився через refresh token
- [ ] Сесія не перервалась
- [ ] Користувач не розлогінився

### TC-019: Вихід з системи
**Кроки:**
1. Знайти кнопку Logout
2. Натиснути

**Очікуваний результат:**
- [ ] Токени видалені з localStorage
- [ ] Перенаправлення на сторінку логіну
- [ ] WebSocket з'єднання закрите

---

## 2. API Key Аутентифікація

### TC-020: Запит з валідним API key
**Кроки:**
1. Виконати запит:
```bash
curl -H "X-API-Key: YOUR_API_KEY" http://localhost:8000/api/status
```

**Очікуваний результат:**
- [ ] Відповідь 200 OK
- [ ] Дані статусу повернуті

### TC-021: Запит з невалідним API key
**Кроки:**
```bash
curl -H "X-API-Key: invalid_key" http://localhost:8000/api/status
```

**Очікуваний результат:**
- [ ] Відповідь 401 Unauthorized
- [ ] Повідомлення про невалідний ключ

### TC-022: Запит без API key
**Кроки:**
```bash
curl http://localhost:8000/api/status
```

**Очікуваний результат:**
- [ ] Відповідь 401 Unauthorized (якщо auth обов'язковий)
- [ ] Або 200 OK (якщо публічний endpoint)

---

## 3. Rate Limiting

### TC-023: Rate limit для API
**Кроки:**
1. Виконати 100+ запитів за хвилину:
```bash
for i in {1..150}; do curl -s http://localhost:8000/api/health; done
```

**Очікуваний результат:**
- [ ] Перші N запитів успішні (200)
- [ ] Після ліміту - 429 Too Many Requests
- [ ] Header `X-RateLimit-Remaining` зменшується
- [ ] Header `X-RateLimit-Reset` показує час скидання

### TC-024: Rate limit для WebSocket
**Кроки:**
1. Відкрити багато WS з'єднань (>10)

**Очікуваний результат:**
- [ ] Нові з'єднання відхиляються
- [ ] Існуючі з'єднання працюють

### TC-025: Rate limit per IP
**Кроки:**
1. Симулювати запити з різних IP (якщо можливо)

**Очікуваний результат:**
- [ ] Rate limit рахується окремо для кожного IP
- [ ] Один IP не блокує інших

---

## 4. Security Headers

### TC-026: Перевірка security headers
**Кроки:**
```bash
curl -I http://localhost:8000
```

**Очікуваний результат:**
- [ ] `X-Content-Type-Options: nosniff`
- [ ] `X-Frame-Options: DENY` або `SAMEORIGIN`
- [ ] `X-XSS-Protection: 1; mode=block`
- [ ] `Strict-Transport-Security` (для HTTPS)
- [ ] `Content-Security-Policy` налаштовано

### TC-027: CORS налаштування
**Кроки:**
1. Виконати запит з іншого домену (через браузер або curl з Origin header)
```bash
curl -H "Origin: http://evil.com" -I http://localhost:8000/api/status
```

**Очікуваний результат:**
- [ ] CORS заблоковано для невідомих доменів
- [ ] `Access-Control-Allow-Origin` тільки для дозволених

---

## 5. Input Validation

### TC-028: SQL Injection prevention
**Кроки:**
1. Спробувати ввести SQL injection в поля:
```
Symbol: BTCUSDT'; DROP TABLE trades;--
```

**Очікуваний результат:**
- [ ] Запит відхилено або escaped
- [ ] База даних не пошкоджена
- [ ] Логується спроба атаки

### TC-029: XSS Prevention
**Кроки:**
1. Спробувати ввести JavaScript:
```
<script>alert('XSS')</script>
```

**Очікуваний результат:**
- [ ] Скрипт не виконується
- [ ] Текст escaped або відфільтрований
- [ ] Сторінка працює нормально

### TC-030: Command Injection prevention
**Кроки:**
1. Спробувати ввести shell команди в параметри

**Очікуваний результат:**
- [ ] Команди не виконуються
- [ ] Input валідується

---

## 6. Захист від CSRF

### TC-031: CSRF Token validation
**Кроки:**
1. Виконати POST запит без CSRF token (якщо використовується)

**Очікуваний результат:**
- [ ] Запит відхилено 403 Forbidden
- [ ] Повідомлення про missing/invalid CSRF token

---

## 7. Session Management

### TC-032: Одночасні сесії
**Кроки:**
1. Залогінитись в браузері 1
2. Залогінитись в браузері 2 з тим самим акаунтом

**Очікуваний результат:**
- [ ] Обидві сесії працюють (або перша закривається - залежить від політики)
- [ ] Визначена поведінка задокументована

### TC-033: Session timeout
**Кроки:**
1. Залогінитись
2. Не робити нічого протягом session timeout (наприклад, 30 хв)
3. Спробувати виконати дію

**Очікуваний результат:**
- [ ] Сесія завершилась
- [ ] Користувача перенаправлено на логін
- [ ] Refresh token може продовжити сесію (якщо активний)

---

## 8. Sensitive Data Protection

### TC-034: API keys не відображаються в UI
**Кроки:**
1. Переглянути налаштування на дашборді

**Очікуваний результат:**
- [ ] API keys замасковані (****...)
- [ ] Повний ключ не видно в HTML коді
- [ ] В Network tab ключі не передаються зайвий раз

### TC-035: Паролі не логуються
**Кроки:**
1. Залогінитись
2. Перевірити логи сервера

**Очікуваний результат:**
- [ ] Пароль не відображається в логах
- [ ] Логується тільки факт логіну, не credentials

### TC-036: Sensitive data в error messages
**Кроки:**
1. Викликати помилку (невалідні дані)

**Очікуваний результат:**
- [ ] Error message не містить stack trace в production
- [ ] Немає витоку internal paths або configs
